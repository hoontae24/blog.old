<!DOCTYPE html>
<html>
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
    AWS EC2 + RDS에 Node.js 서버 배포하기(Ubuntu, Mysql) | 코드블로그
    
  </title>
  <meta name="description" content="보통의 웹 서비스는 서버를 이용하여 서비스를 제공합니다. 서버 컴퓨터를 직접 구성해서 할 수도 있지만, 요즘에는 클라우드 서비스를 많이 이용합니다. 클라우드 서비스를 이용하면 물리적으로 서버를 직접 구성하거나 가지고 있지 않아도 되고, 내가 사용할 서비스에만 집중하여 서버를 운영할...">
  <!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="AWS EC2 + RDS에 Node.js 서버 배포하기(Ubuntu, Mysql)" />
<meta name="author" content="Hoontae" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="보통의 웹 서비스는 서버를 이용하여 서비스를 제공합니다. 서버 컴퓨터를 직접 구성해서 할 수도 있지만, 요즘에는 클라우드 서비스를 많이 이용합니다. 클라우드 서비스를 이용하면 물리적으로 서버를 직접 구성하거나 가지고 있지 않아도 되고, 내가 사용할 서비스에만 집중하여 서버를 운영할 수 있습니다. 이번 포스트에서는 대표적인 클라우드 컴퓨팅 서비스 중 하나인 Amazon Web Service(AWS)를 이용하여 Node.js 서버를 배포해보겠습니다." />
<meta property="og:description" content="보통의 웹 서비스는 서버를 이용하여 서비스를 제공합니다. 서버 컴퓨터를 직접 구성해서 할 수도 있지만, 요즘에는 클라우드 서비스를 많이 이용합니다. 클라우드 서비스를 이용하면 물리적으로 서버를 직접 구성하거나 가지고 있지 않아도 되고, 내가 사용할 서비스에만 집중하여 서버를 운영할 수 있습니다. 이번 포스트에서는 대표적인 클라우드 컴퓨팅 서비스 중 하나인 Amazon Web Service(AWS)를 이용하여 Node.js 서버를 배포해보겠습니다." />
<link rel="canonical" href="https://hoontae24.github.io/posts/10" />
<meta property="og:url" content="https://hoontae24.github.io/posts/10" />
<meta property="og:site_name" content="코드블로그" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-02-23T00:00:00+09:00" />
<script type="application/ld+json">
{"headline":"AWS EC2 + RDS에 Node.js 서버 배포하기(Ubuntu, Mysql)","dateModified":"2020-02-23T00:00:00+09:00","datePublished":"2020-02-23T00:00:00+09:00","url":"https://hoontae24.github.io/posts/10","mainEntityOfPage":{"@type":"WebPage","@id":"https://hoontae24.github.io/posts/10"},"author":{"@type":"Person","name":"Hoontae"},"description":"보통의 웹 서비스는 서버를 이용하여 서비스를 제공합니다. 서버 컴퓨터를 직접 구성해서 할 수도 있지만, 요즘에는 클라우드 서비스를 많이 이용합니다. 클라우드 서비스를 이용하면 물리적으로 서버를 직접 구성하거나 가지고 있지 않아도 되고, 내가 사용할 서비스에만 집중하여 서버를 운영할 수 있습니다. 이번 포스트에서는 대표적인 클라우드 컴퓨팅 서비스 중 하나인 Amazon Web Service(AWS)를 이용하여 Node.js 서버를 배포해보겠습니다.","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
  <link rel='stylesheet' href='//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.css'>
  <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="/assets/vendor/bootstrap/css/bootstrap.min.css">

  <link rel="stylesheet" href="/assets/vendor/fontawesome-free/css/all.min.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">

  <link href="/img/ico/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon"/>

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://hoontae24.github.io/posts/10">
  <link rel="alternate" type="application/rss+xml" title="코드블로그" href="/feed.xml">

</head>

<script>
  const listeners = []
  const onMount = listener => listeners.push(listener)
  window.addEventListener('load', () => {
    listeners.forEach(listener => listener && listener())
  })
</script>

<body>
  <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="navbar-wrapper">
    <a class="navbar-brand" href="/" >
      코드블로그
    </a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
  </div>
  <div class="collapse navbar-collapse" id="navbarResponsive">
    <ul class="navbar-nav ml-auto">
      <!-- <li class="nav-item">
        <a class="nav-link" href="/">HOME</a>
      </li> -->
      <li class="nav-item">
        <a class="nav-link" href="/posts">POSTS</a>
      </li>
      <!-- <li class="nav-item">
          <a class="nav-link" href="/tags">TAGS</a>
      </li> -->
      <li class="nav-item">
          <a class="nav-link" href="/archives">ARCHIVES</a>
      </li>
      <li class="nav-item">
          <a class="nav-link" href="/about">ABOUT</a>
      </li>
    </ul>
  </div>
</nav>


  <!-- Page Header -->

<header
  class="masthead"
  style="background-image: url('/img/posts/aws/aws_node.png')"
>
  
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="post-heading">
            <h1>AWS EC2 + RDS에 Node.js 서버 배포하기(Ubuntu, Mysql)</h1>
            
            <span class="meta">
              <!-- >Posted by
              <a href="/about"
                >Hoontae</a
              >
              on  -->
              2020.02.23 &middot; <span class="reading-time" title="Estimated read time">
  
   10 mins  read </span>

            </span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="container post">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto wrapper">
        

<script>
  const btnFolded = document.querySelector('.btn.folded')
  const btnUnfolded = document.querySelector('.btn.unfolded')
  btnFolded && btnFolded.classList.add('hidden')
  btnUnfolded && btnUnfolded.classList.remove('hidden')  

  function toggleFold () {
    const btnFolded = document.querySelector('.btn.folded')
    const btnUnfolded = document.querySelector('.btn.unfolded')
    const titleWrapper = document.querySelector('.title-wrapper')
    const itemWrapper = document.querySelector('.item-wrapper')
    btnFolded.classList.toggle('hidden')
    btnUnfolded.classList.toggle('hidden')
    titleWrapper.classList.toggle('folded')
    itemWrapper.classList.toggle('folded')
  }
</script>
 <p>보통의 웹 서비스는 서버를 이용하여 서비스를 제공합니다. 서버 컴퓨터를 직접 구성해서 할 수도 있지만, 요즘에는 클라우드 서비스를 많이 이용합니다. 클라우드 서비스를 이용하면 물리적으로 서버를 직접 구성하거나 가지고 있지 않아도 되고, 내가 사용할 서비스에만 집중하여 서버를 운영할 수 있습니다. 이번 포스트에서는 대표적인 클라우드 컴퓨팅 서비스 중 하나인 Amazon Web Service(AWS)를 이용하여 Node.js 서버를 배포해보겠습니다.</p>

<p>오늘 배포할 웹 서비스 환경은 다음과 같이 구성됩니다.</p>

<ul>
  <li>Node.js 웹 어플리케이션</li>
  <li>AWS EC2와 Ubuntu (+ nginx 프록시)</li>
  <li>AWS RDS와 Mysql</li>
</ul>

<p>우리가 만든(미리 만들어둔) 웹 어플리케이션을 EC2의 Ubuntu에 구성할 것입니다. 그리고 서비스에 사용될 데이터베이스는 RDS의 Mysql 서버를 구성할 것입니다.</p>

<hr />

<h3 id="0-nodejs-웹-어플리케이션-준비하기">0. Node.js 웹 어플리케이션 준비하기</h3>

<p>우리의 웹 서비스가 실제로 동작할 웹 어플리케이션이 필요합니다. 여기서는 Node.js 웹 어플리케이션을 사용할 것인데, 간단한 Node.js REST Api 서버를 만듭니다. <em>(Node.js 어플리케이션에 대한 부분은 자세히 다루지 않습니다.)</em></p>

<p>저는 미리 준비한 Node 앱을 가져오겠습니다. 먼저 로컬에 설치해서 잘 동작하는 지 확인해볼게요. 코드를 깃헙에서 가져오고, 빌드 후 구동합니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://github.com/hoontae24/node-simple-server.git
<span class="nv">$ </span><span class="nb">cd </span>simple-node-server
<span class="nv">$ </span>npm <span class="nb">install</span>
<span class="nv">$ </span>npm run build
<span class="nv">$ </span>npm start
</code></pre></div></div>

<p>서버가 시작하고, 브라우저에서 요청을 보내어 동작을 확인해봅니다.</p>

<p><img src="/img/posts/aws/node_simple_server.png" alt="사진" /></p>

<p>간단한 응답이 도착하네요. 로컬에서 서버가 잘 동작하는 것 같습니다. 서버를 종료해줍니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm run stop
</code></pre></div></div>

<hr />

<h3 id="1-ec2-서버-구성하기">1. EC2 서버 구성하기</h3>

<p>EC2(Amazon Elastic Compute Cloud)는 클라우드에서 컴퓨팅 서비스를 이용할 수 있도록 해줍니다. AWS에서 인스턴스를 만들고, SSH로 원격 연결을 통해 서버 컴퓨터를 제어할 수 있습니다.</p>

<h4 id="11-ec2-인스턴스-만들기">1.1 EC2 인스턴스 만들기</h4>

<p>AWS로 가서 EC2 인스턴스를 만들어 봅시다. <a href="https://ap-northeast-2.console.aws.amazon.com/ec2/home?region=ap-northeast-2">EC2 Management Console</a>에 들어가서 <code class="highlighter-rouge">인스턴스 시작</code>을 선택합니다.</p>

<p><img src="/img/posts/aws/aws_ec2_instance_1.png" alt="사진" /></p>

<p>AMI 템플릿은 빠른시작 탭에서 <code class="highlighter-rouge">Ubuntu Server 18버전</code>을 선택하겠습니다.</p>

<p><img src="/img/posts/aws/aws_ec2_instance_2.png" alt="사진" /></p>

<p>인스턴스는 기본으로 선택되어있는 <code class="highlighter-rouge">t2.micro 유형</code>을 선택하겠습니다.</p>

<p><img src="/img/posts/aws/aws_ec2_instance_3.png" alt="사진" /></p>

<p>저는 새 보안 그룹 생성을 하고, 적당한 이름을 붙여주겠습니다. 규칙은 기본으로 작성된 대로 모든 IP에서 접속 가능하도록 하겠습니다.</p>

<p><img src="/img/posts/aws/aws_ec2_instance_4.png" alt="사진" /></p>

<p>다음 인스턴스 시작 검토에서 <code class="highlighter-rouge">시작하기</code>를 선택하고, <code class="highlighter-rouge">새 키페어 생성</code>을 선택합니다. 적당한 이름을 붙여주고 <code class="highlighter-rouge">키 페어 다운로드</code>를 선택합니다.</p>

<p>키 페어 파일(<code class="highlighter-rouge">.pem</code>)이 다운로드 되면, 파일을 따로 보관해주세요. SSH 연결 시 사용됩니다.</p>

<p>이제 <code class="highlighter-rouge">인스턴스 시작</code>을 선택합니다.</p>

<p><img src="/img/posts/aws/aws_ec2_instance_5.png" alt="사진" /></p>

<p>AWS EC2 인스턴스 생성을 완료했습니다. EC2 인스턴스 탭에 새로운 인스턴스가 생성되었는지 확인해보세요.</p>

<h4 id="12-ec2-인스턴스에-접속하기">1.2 EC2 인스턴스에 접속하기</h4>

<p>EC2 컴퓨터에 접속하는 방법은 여러가지가 있습니다. <a href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/AccessingInstances.html">여기</a>를 참조해 주세요. 저는 이 중에서 Windows에서 <a href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/putty.html">PuTTY를 사용하여 접속</a>하는 방법으로 연결해보겠습니다.</p>

<p>먼저 AWS 설명서의 안내대로 <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/">PuTTY를 설치</a>합니다. windows용 최신 버전으로 설치합니다.</p>

<p>설치가 완료되었으면 <code class="highlighter-rouge">PuTTYGen</code>을 이용하여 <code class="highlighter-rouge">.pem</code>파일을 <code class="highlighter-rouge">PuTTY</code>에서 사용되어지는 <code class="highlighter-rouge">.ppk</code>파일로 변환합니다. <code class="highlighter-rouge">PuTTY</code>와 함께 설치된 <code class="highlighter-rouge">PuTTYGen</code>을 실행합니다.</p>

<p>생성할 키 유형을 <code class="highlighter-rouge">RSA</code>로 선택하고, <code class="highlighter-rouge">Load</code>를 선택하여 인스턴스를 생성할 때 생성했던 <code class="highlighter-rouge">키 페어(.pem)</code> 파일을 불러옵니다. 그리고 <code class="highlighter-rouge">Save private key</code>를 선택하고 <code class="highlighter-rouge">.ppk</code>형식으로 저장합니다.</p>

<p><img src="/img/posts/aws/aws_ec2_connect_1.png" alt="사진" /></p>

<p>이제 <code class="highlighter-rouge">PuTTY</code>를 실행해주세요. 아래와 같은 창이 뜨면, 빈칸을 입력해줍니다.</p>

<p><img src="/img/posts/aws/aws_ec2_connect_2.png" alt="사진" /></p>

<p>(1) Hostname: <code class="highlighter-rouge">{username}@{public_dns_name}</code>형식의 주소를 입력합니다. <code class="highlighter-rouge">username</code>부분은 <code class="highlighter-rouge">"Ubuntu"</code>이고 <code class="highlighter-rouge">public_dns_name</code>은 EC2의 주소입니다. 아래 사진처럼 AWS EC2 Management Console에서 해당 인스턴스의 Public Dns를 확인해주세요.</p>

<p><img src="/img/posts/aws/aws_ec2_connect_3.png" alt="사진" /></p>

<p>(2) Port: 22(ssh) 포트를 확인해주세요.</p>

<p>(3) Connection Type: SSH 선택을 확인해주세요.</p>

<p>(4) 왼쪽의 메뉴에서 Connection / SSH / Auth 탭을 선택하고, <code class="highlighter-rouge">PuTTYGen</code>으로 저장한 <code class="highlighter-rouge">.ppk</code>파일을 불러옵니다.</p>

<p><img src="/img/posts/aws/aws_ec2_connect_4.png" alt="사진" /></p>

<p>(5) 이제 <code class="highlighter-rouge">Open</code>을 선택합니다. 아래와 같이 보안 알림이 뜨면 <code class="highlighter-rouge">예</code>를 선택합니다.(인스턴스에 처음으로 접속할 때, 인스턴스 호스트가 신뢰할만 한 지 PuTTY가 묻습니다.)</p>

<p><img src="/img/posts/aws/aws_ec2_connect_5.png" alt="사진" /></p>

<p>아래와 같이 원격 콘솔이 실행되네요. 접속에 성공했습니다.</p>

<p><img src="/img/posts/aws/aws_ec2_connect_6.png" alt="사진" /></p>

<hr />

<h3 id="2-rds-데이터베이스-구성하기">2. RDS 데이터베이스 구성하기</h3>

<p>EC2가 웹 애플리케이션 서비스를 담당하는 서버 역할을 한다면, RDS는 웹 서비스의 데이터베이스 서버 역할을 담당합니다. 규모가 작고 트래픽이 적은 서비스라면 EC2 서버 컴퓨터에 로컬로 구성하여 사용할 수 있지만, AWS RDS를 이용하여 데이터베이스를 구성해 보겠습니다.</p>

<h4 id="21-rds-인스턴스-생성하기">2.1 RDS 인스턴스 생성하기</h4>

<p>AWS의 RDS 페이지로 가서, <code class="highlighter-rouge">데이터베이스 생성</code>을 선택합니다.</p>

<p><img src="/img/posts/aws/aws_rds_instance_1.png" alt="사진" /></p>

<p>데이터베이스 엔진을 <code class="highlighter-rouge">Mysql</code>로 선택하고, 적당한 이름을 설정합니다. 마스터 사용자 이름과 암호를 입력합니다.</p>

<p>그리고 <code class="highlighter-rouge">연결 섹션</code>에서 <code class="highlighter-rouge">추가 연결 구성</code>을 열고 <code class="highlighter-rouge">VPC 보안 그룹</code>을 EC2의 보안그룹과 같은 그룹으로 선택합니다. 이제 <code class="highlighter-rouge">데이터베이스 생성</code>을 선택하여 다음으로 진행합니다.</p>

<p><img src="/img/posts/aws/aws_rds_instance_2.png" alt="사진" /></p>

<p>대시보드에서 생성이 완료될 때까지 잠깐 기다립니다.</p>

<h4 id="22-rds-인스턴스에-접속하기">2.2 RDS 인스턴스에 접속하기</h4>

<p>RDS 인스턴스에 접속하기 위해서는 AWS 보안그룹 설정에서 접속을 허용해주어야 합니다. RDS의 보안그룹을 따로 가지면 좋겠지만, 이 포스트에서는 EC2의 보안그룹으로 같이 사용하겠습니다.</p>

<p>EC2와 RDS의 보안그룹 설정으로 들어가주세요. (만약, EC2와 RDS의 보안그룹이 다르다면, 같은 보안그룹으로 설정해주세요.)</p>

<p><img src="/img/posts/aws/aws_rds_connect_1.png" alt="사진" /></p>

<p>보안 그룹을 선택하고, <code class="highlighter-rouge">인바운드 규칙</code>을 편집합니다. <code class="highlighter-rouge">규칙 추가</code>를 선택하여 <code class="highlighter-rouge">Mysql/Aurora</code>유형을 선택하고, 포트 범위는 <code class="highlighter-rouge">3306</code>으로 지정합니다. 주소는 현재 보안그룹의 <code class="highlighter-rouge">ID</code>를 입력하고 저장합니다.</p>

<p><img src="/img/posts/aws/aws_rds_connect_2.png" alt="사진" /></p>

<p>이제 EC2에서 RDS Mysql(3306) 서버로 접속할 수 있습니다.</p>

<p>EC2 콘솔에서 <code class="highlighter-rouge">mysql-server</code>를 설치합니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>apt-get update
<span class="nv">$ </span><span class="nb">sudo </span>apt-get <span class="nb">install </span>mysql-server
</code></pre></div></div>

<p>그리고 mysql client를 이용하여 RDS의 mysql 서버에 접속합니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># mysql -u {username} -p -h {rds_endpoint_url}</span>
<span class="c"># 제 경우에는 아래와 같습니다.</span>
<span class="nv">$ </span>mysql <span class="nt">-u</span> development <span class="nt">-p</span> <span class="nt">-h</span> node-simple-db.ctq3ujxhpaow.ap-northeast-2.rds.amazonaws.com

Enter password: <span class="c"># 패스워드 입력</span>
</code></pre></div></div>

<p>RDS의 mysql 서버에 접속이 되었다면, 웹 서비스가 사용할 Database를 생성해줍니다. 제가 간단히 작성한 Node 서버는 DB 연결만 이루어지고, 실제 작업은 구현된 게 없어서 따로 테이블은 만들지 않겠습니다.</p>

<pre><code class="language-mysql">mysql&gt; CREATE DATABASE node_simple_server;
</code></pre>

<p>이제 RDS도 준비되었습니다.</p>

<hr />

<h3 id="3-ec2에-웹-서비스-배포하기">3. EC2에 웹 서비스 배포하기</h3>

<h4 id="31-nodejs-npm-설치하기">3.1 Node.js, NPM 설치하기</h4>

<p>EC2에 Node.js가 설치되어 있지 않았다면 설치해주세요.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install </span>nodejs
<span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install </span>npm

<span class="c"># 설치 확인</span>
<span class="nv">$ </span>node <span class="nt">-v</span>
<span class="nv">$ </span>npm <span class="nt">-v</span>
</code></pre></div></div>

<h4 id="32-node-웹-서버-배포하기">3.2 Node 웹 서버 배포하기</h4>

<p>이제 EC2에서 웹 서비스 프로젝트를 불러옵니다. 깃과 깃헙을 이용해서 불러오겠습니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://github.com/hoontae24/node-simple-server
<span class="nv">$ </span><span class="nb">cd </span>node-simple-server
<span class="nv">$ </span>npm <span class="nb">install</span>
</code></pre></div></div>

<p>RDS 데이터베이스 서버에 연결할 수 있도록 약간의 설정을 수정해주세요. Database HOST, USERNAME, PASSWORD 등의 정보를 알맞게 수정합니다. 그리고 웹 서비스를 빌드하고, 서버를 시작하겠습니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm run build
<span class="nv">$ </span>npm start
</code></pre></div></div>

<p>이제 Node 서버가 구동되었는데요, 제가 작성한 Node 서버는 3000번 포트에 열려있습니다. EC2 보안그룹 인바운드 규칙에 3000번 포트를 열어주어야 합니다. (저는 http 전용 포트와 https 전용 포트도 함께 열어주었습니다.)</p>

<p><img src="/img/posts/aws/aws_deploy_1.png" alt="사진" /></p>

<p>이렇게 포트를 열었으면 EC2 서버에 접속할 수 있습니다. <code class="highlighter-rouge">EC2 퍼블릭 DNS</code>를 주소창에 입력하고, 접속할 포트번호를 입력해주세요.</p>

<pre><code class="language-url">http://ec2-54-180-25-154.ap-northeast-2.compute.amazonaws.com:3000/
</code></pre>

<p><img src="/img/posts/aws/aws_deploy_2.png" alt="사진" /></p>

<p>브라우저에서 주소창을 이용해 요청을 보내면 정상적으로 응답이 돌아오는 것을 확인할 수 있습니다.</p>

<h4 id="33-nginx-프록시-서버-구성하기">3.3 Nginx 프록시 서버 구성하기</h4>

<p>Node 서버는 3000번 포트에 열려있는데, 일반적으로 서비스 url에는 포트번호를 포함하지 않습니다. 그래서 Nginx 프록시 서버를 이용해 http(80) 또는 https(443) 요청이 오면, 원하는 서비스로 매핑해줄 수 있습니다. 지금의 경우에는 <code class="highlighter-rouge">:3000</code>을 쓰지 않고 URL만으로 서비스에 요청할 수 있도록 매핑할 것입니다.</p>

<p>먼저 EC2 Ubuntu에 <code class="highlighter-rouge">Nginx</code>를 설치합니다. 설치가 완료되면 <code class="highlighter-rouge">nginx</code>를 실행해보겠습니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 설치</span>
<span class="nv">$ </span><span class="nb">sudo </span>apt-get <span class="nb">install </span>nginx

<span class="c"># 실행</span>
<span class="nv">$ </span><span class="nb">sudo </span>service nginx start
</code></pre></div></div>

<p>nginx가 실행되었는지 확인하기 위해서, <code class="highlighter-rouge">퍼블릭 DNS</code>로 접속해봅니다. 브라우저에서 EC2의 url로 접속해보겠습니다.</p>

<p><img src="/img/posts/aws/aws_deploy_3.png" alt="사진" /></p>

<p>nginx가 잘 실행되니, 웹 서비스로 요청을 분배하도록 설정해주겠습니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>find / <span class="nt">-name</span> nginx.conf
<span class="c"># &gt;&gt; /etc/nginx/nginx.conf</span>
<span class="nv">$ </span><span class="nb">cd</span> /etc/nginx/sites-available
<span class="nv">$ </span><span class="nb">sudo </span>vi default
</code></pre></div></div>

<p><code class="highlighter-rouge">default</code> 파일에서 기본 설정으로 되어있는 내용을 지우고 다음과 같이 입력해주세요.</p>

<pre><code class="language-txt">server {
    listen 80;

    location / {
      proxy_pass http://127.0.0.1:3000;
    }
}
</code></pre>

<p>수정된 내용을 저장하고, <code class="highlighter-rouge">nginx</code>를 다시 시작하겠습니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>service nginx restart
</code></pre></div></div>

<p>이제 <code class="highlighter-rouge">EC2 퍼블릭 DNS</code>에 포트 번호 없이 접속해보겠습니다.</p>

<p><img src="/img/posts/aws/aws_deploy_4.png" alt="사진" /></p>

<p>잘 접속되는 것을 볼 수 있습니다. 이렇게 <code class="highlighter-rouge">nginx</code>를 이용하면, 웹 서비스가 제공하는 엔드포인트에 EC2서버로 들어오는 요청을 매핑할 수 있습니다. 또한 하나의 EC2 컴퓨터 서버에 여러 개의 서비스를 구동시키고, 각각 다른 엔드포인트로 접근할 수 있게 할 수 있습니다. 만약 프론트 엔드 서버와 API 서버가 있다면 각각을 다음과 같이 매핑할 수 있죠.</p>

<ul>
  <li>프론트엔드 서버: {퍼블릭 DNS}/</li>
  <li>API 서버: {퍼블릭 DNS}/api</li>
</ul>

<p>다른 두 개의 서비스를 하나의 도메인으로 제공할 수도 있습니다.</p>

<hr />

<h3 id="마무리">마무리</h3>

<p>여기까지 AWS의 클라우드 서비스인 EC2와 RDS를 이용하여 Node.js 웹 서비스를 배포해 보았습니다. 간단히 연결하는 작업만 해보았지만, 막상 하기전에 생각했던 것보다 복잡하지는 않았습니다. 아주 간단하지는 않지만 어떤 식으로 연결하고 구성하는 지 알게 되었습니다.</p>

<p>서비스 규모가 커지거나 복잡해 질수록 더 많은 설정이 필요하겠지만 기본적인 개념을 익힐 수 있는 시간이었던 것 같습니다. 다음에는 AWS의 다른 클라우드 서비스나, Google Firebase, Microsoft Azure와 같은 다른 서비스를 알아보는 시간도 가져보겠습니다.</p>

        <div class="post-bottom-margin"></div>
         




<span 
  class="tag tag-chip btn-route"
  path="/tags#AWS"
  title=""
>
  <span class="label">
      AWS
  </span>
  
</span>
  




<span 
  class="tag tag-chip btn-route"
  path="/tags#EC2"
  title=""
>
  <span class="label">
      EC2
  </span>
  
</span>
  




<span 
  class="tag tag-chip btn-route"
  path="/tags#RDS"
  title=""
>
  <span class="label">
      RDS
  </span>
  
</span>
  




<span 
  class="tag tag-chip btn-route"
  path="/tags#Node"
  title=""
>
  <span class="label">
      Node
  </span>
  
</span>
  




<span 
  class="tag tag-chip btn-route"
  path="/tags#Mysql"
  title=""
>
  <span class="label">
      Mysql
  </span>
  
</span>
 
        <div class="post-bottom-margin"></div>

        <!-- <div class="clearfix">
          
          <a
            class="btn btn-primary float-left"
            href="/posts/9"
            data-toggle="tooltip"
            data-placement="bottom"
            title="Node와 Babel + Typesciprt + Eslint 개발 환경 구성하기"
            >&larr; Previous<span class="d-none d-md-inline"> Post</span></a
          >
           
          <a
            class="btn btn-primary float-right"
            href="/posts/11"
            data-toggle="tooltip"
            data-placement="bottom"
            title="자주 사용하는 Git 명령어 정리"
            >Next<span class="d-none d-md-inline"> Post</span> &rarr;</a
          >
          
        </div> -->
      </div>
    </div>
  </div>
</header>


  <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          <li class="list-inline-item">
            <a href="mailto:kadr8941@gmail.com">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://github.com/hoontae24">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="copyright text-muted">Copyright &copy; hoontae 2020</p>
      </div>
    </div>
  </div>
</footer>

  <script src="/assets/vendor/jquery/jquery.min.js"></script>
<script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/startbootstrap-clean-blog/js/clean-blog.min.js"></script>

<script src="/assets/scripts.js"></script>
<script src="/assets/js/post.js"></script>
<script src="/assets/js/global.js"></script>



  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151335869-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151335869-1');
</script>


  <div class="scrollToTopButton" onclick="_toTop()">
  <i class="fas fa-arrow-up"></i>
</div>

<script>
  const _toTop = () => {
    const isHigh = window.scrollY > 2000
    window.scrollTo({
      top: 0,
      left: 0,
      behavior: isHigh ? 'auto' : 'smooth',
    })
  }
  onMount(() => {
    const btn = document.querySelector('div.scrollToTopButton')
    const showBtn = () => {
      window.scrollY > 100
        ? !btn.classList.contains('show') && btn.classList.add('show')
        : btn.classList.contains('show') && btn.classList.remove('show')
    }
    showBtn()
    window.addEventListener('scroll', showBtn)
  })
</script>

<style>
  .scrollToTopButton {
    position: fixed;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 40px;
    height: 40px;
    right: 40px;
    bottom: 40px;

    cursor: pointer;
    border: 1px solid #000000a2;
    color: #000000a2;
    background-color: #ffffff99;
    border-radius: 50%;
    overflow: hidden;
    visibility: hidden;
  }
  .scrollToTopButton.show {
    visibility: visible;
  }
  @media only screen and (max-width: 767px) {
    .scrollToTopButton {
      width: 30px;
      height: 30px;
      right: 20px;
      bottom: 20px;
    }
  }
</style>

</body>
</html>
