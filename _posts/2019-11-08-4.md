---
layout: post
title: Svelte로 만드는 TODO-App (2)
subtitle: 데이터 Store 구현하기 / CRUD 구현하기
author: Hoontae
categories: svelte
tags: javascript frontend svelte
background: /img/posts/3/svelte_2.png
featured: true
hidden: false
permalink: '/posts/:title'
seriesId: 2
---

지난 시간에 이어서 `boards`와 `items` 데이터를 `Store`를 만들어서 관리하고, `CRUD`를 구현하겠습니다.

### 1. Store 구현하기  

`Svelte`는 이미 `Store` 기능을 내장하고 있습니다. `svelte/store`를 `import`하면 그 기능을 사용할 수 있습니다.

먼저 `Store`를 구현할 파일을 만들도록 하겠습니다. `/src`폴더 아래에 `stores`폴더를 만들고, `index.js`파일을 생성합니다.  

만약 `Store`로 사용할 데이터가 많다면 `/stores`폴더 안에 여러 파일을 만들어 구현하면 관리가 편하겠지만, 현재 프로젝트에서는 `boards`와 `items` 두 개의 데이터만 관리하면 되니, `index.js`파일 안에 함께 구현하도록 하겠습니다.

`Store`에 대한 기본 지식은 [svelte/store 공식 API 문서](https://svelte.dev/docs#svelte_store)를 참조해주세요.

#### 1.1 boards 데이터 Store로 구현하기

이제 `/src/stores/index.js`파일을 다음과 같이 작성합니다.

```js
// src/stores/index.js
import { writable } from 'svelte/store'
import uuid from 'uuid/v4'

const _boards = [
  { id: 1, title: 'Planning' },
  { id: 2, title: 'In Progress' },
  { id: 3, title: 'All Done' },
]

const createBoards = () => {
  const boards = writable(_boards)
  const { subscribe, reset, update: _update } = boards

  const add = () => {
    _update(boards => boards.concat({ id: uuid(), title: '' }))
  }

  const remove = board => {
    if (!board) return
    _update(boards => boards.filter(_board => _board.id !== board.id))
  }

  const update = board => {
    if (!board) return
    _update(boards => boards.map(_board => (_board.id === board.id ? board : _board)))
  }

  return { subscribe, reset, add, remove, update }
}

export const boards = createBoards()
```

`Store 모듈`에서 불러온 ```writable```함수의 파라미터로 초기화 할 `boards`데이터를 넣어줍니다.

생성된 `Store`객체 `boards`에서 `update`메소드를 이용해 `add`, `remove`, `update` 함수를 구현합니다. (`update`라는 이름의 함수를 따로 구현하기 위해서 원래의 `update`메소드를 `_update`로 명명하였음.)

`createBoards`함수가 리턴하는 객체의 `add`, `remove`, `update`함수는 데이터를 다루는 데에 사용하기 위해 구현하였고, `subscribe`, `reset`함수는 컴포넌트 내에서 `$boards`로 접근하기 위해서 함께 넘겨줍니다.

`add`함수에서 `board`를 생성하려고 할 때 id가 필요한데, 중복되지 않는 값이 필요하므로 `uuid`를 사용하도록 하겠습니다. 상단에서 `uuid`를 import 하고, 콘솔로 가서 모듈을 설치하겠습니다.

> $ npm install uuid

`package.json`파일을 열어보면, 다음과 같이 모듈이 의존성에 추가된 것을 볼 수 있습니다.

```json
// package.json
"dependencies": {
    "sirv-cli": "^0.4.4",
    "uuid": "^3.3.3"
  },
```

다음은 `App.svelte`파일로 가서 만들어둔 `boards`를 불러오겠습니다.

`./stores`에서 `boards`를 import하고, 기존에 사용하던 boards배열 데이터는 삭제하겠습니다.

```html
<!-- App.svelte -->
<script>
  import { boards } from './stores'

  // 기존의 데이터는 삭제
  // const boards = [
  //   { id: 1, title: 'Planning' },
  //   { id: 2, title: 'In Progress' },
  //   { id: 3, title: 'All Done' },
  // ]

  // (... 생략 ...)
</script>

  <!-- 기존의 boards를 $boards로 바꿔줍니다. -->
  <!-- {#each boards as board (board.id)} -->
  {#each $boards as board (board.id)}
    <div class="item">
      <Board
        board={board}
        items={items.filter(item => item.boardId === board.id)}
      />
    </div>
  {/each}
  
  <!-- (... 생략 ...) -->
```

앞서 말했던 것 처럼, `boards`자체는 `Store`객체이기 때문에, 해당하는 데이터에 접근하려면 `$`를 앞에 붙여야 합니다.

이제 페이지로 접속해서 여전히 잘 동작하는지 확인해보세요. `Store`가 잘 생성되었는지 확인하기 위해서 `boards`의 기본 데이터를 변경해보고, 반영되는지 확인하면 됩니다.

#### 1.2 items 데이터 Store로 구현하기

다음은 `items`데이터를 `Store`로 구현하겠습니다. `boards`에서 했던 것과 거의 동일합니다.

`stores/index.js`파일로 가서 아래의 내용을 추가하겠습니다.

```js
// stores/index.js
const _items = [
  { id: 1, boardId: 1, title: '자료 조사하기', done: false},
  { id: 2, boardId: 1, title: '교양책 읽기', done: false},
  { id: 3, boardId: 2, title: '분리수거하기', done: false},
  { id: 4, boardId: 2, title: '가계부 정리하기', done: false},
  { id: 5, boardId: 3, title: '버그 수정하기', done: false},
]

const createItems = () => {
  const items = writable(_items)
  const { subscribe, reset, update: _update } = items

  const add = boardId => {
    if (!boardId) return
    _update(items => items.concat({ id: uuid(), boardId, title: '', done: false }))
  }

  const remove = item => {
    if (!item) return
    _update(items => items.filter(_item => _item.id !== item.id))
  }

  const update = item => {
    if (!item) return
    _update(items => items.map(_item => (_item.id === item.id ? item : _item)))
  }

  return { subscribe, reset, add, remove, update }
}

export const items = createItems()
```

`boards`와 다른 부분은 `add`함수에서 `item`을 생성할 때, 어느 `board`에 소속해야할 지 알기 위해 `boardId`를 파라미터로 받는 부분입니다. 나머지는 동일합니다.

이제 `App.svelte`파일로 가서 `items`를 불러오겠습니다.

```html
<script>
  import { boards, items } from './stores'

  // 기존 데이터 삭제
  // const items = [
  //   { id: 1, boardId: 1, title: '자료 조사하기', done: false},
  //   { id: 2, boardId: 1, title: '교양책 읽기', done: false},
  //   { id: 3, boardId: 2, title: '분리수거하기', done: false},
  //   { id: 4, boardId: 2, title: '가계부 정리하기', done: false},
  //   { id: 5, boardId: 3, title: '버그 수정하기', done: false},
  // ]
</script>

  <!-- items를 $items로 바꿔줍니다. -->
  <Board
    board={board}
    items={$items.filter(item => item.boardId === board.id)}
  />
```

`items` 역시 기존에 선언해둔 데이터를 삭제하고, `items` 앞에 `$`를 붙여줍니다.

페이지로 가서 잘 동작하는지 확인해보세요.

*Todo-app*에서 사용할 `boards`와 `items`데이터를 `Store`로 구현해 보았습니다. 페이지는 변한 것 없이 그대로지만, 데이터를 관리하는 부분은 수월해졌습니다. 만약 `Store`를 이용하지 않으면, 자식 컴포넌트로 [이벤트](https://svelte.dev/docs#createEventDispatcher)를 전달해서 데이터를 변경하거나, [bind된 속성](https://svelte.dev/docs#bind_component_property)을 이용하면 됩니다.
